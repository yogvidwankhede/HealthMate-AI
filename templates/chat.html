<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HealthMate-AI</title>
  <style>
    :root {
      --bg-color: #f9f9f9;
      --pattern-color: rgba(187, 187, 187, 0.8);
      --text-color: #222;
      --box-bg: rgba(255,255,255,0.85);
      --border-color: #ddd;
      --placeholder-color: #555;
      --scrollbar-track: rgba(255, 255, 255, 0.5);
      --scrollbar-thumb: rgba(200, 200, 200, 0.8);
    }

    body.dark {
      --bg-color: #121212;
      --pattern-color: rgba(68, 68, 68, 0.8);
      --text-color: #eee;
      --box-bg: rgba(30,30,30,0.85);
      --border-color: #333;
      --placeholder-color: #aaa;
      --scrollbar-track: rgba(40, 40, 40, 0.5);
      --scrollbar-thumb: rgba(80, 80, 80, 0.8);
    }

    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: var(--bg-color);
      background-image: repeating-linear-gradient(45deg, var(--pattern-color) 0 1px, transparent 1px 25px), repeating-linear-gradient(-45deg, var(--pattern-color) 0 1px, transparent 1px 25px);
      background-size: 50px 50px;
      color: var(--text-color);
      height: 100vh;
      margin: 0;
      transition: background-color 0.3s, color 0.3s;
      display: flex;
      position: relative;
    }

    /* Custom Scrollbar Styles */
    ::-webkit-scrollbar {
      width: 8px;
    }

    ::-webkit-scrollbar-track {
      background: var(--scrollbar-track);
      border-radius: 10px;
    }

    ::-webkit-scrollbar-thumb {
      background: var(--scrollbar-thumb);
      border-radius: 10px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #555;
    }

    body.dark::before {
      content: none;
    }

    /* Sidebar */
    .sidebar {
      width: 50px;
      background: var(--box-bg);
      border-right: 1px solid var(--border-color);
      padding: 20px 0;
      overflow-y: hidden;
      z-index: 2;
      transition: width 0.3s ease-in-out, padding 0.3s ease-in-out;
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .sidebar.expanded {
      width: 250px;
      padding: 20px;
    }

    .sidebar .sidebar-body {
      display: none;
      flex-grow: 1;
      overflow-y: auto;
      padding-right: 15px;
    }

    .sidebar.expanded .sidebar-body {
      display: block;
    }
    
    .sidebar-header {
      width: 100%;
      display: flex;
      justify-content: flex-end;
      align-items: center;
      padding: 0 15px;
      box-sizing: border-box;
      margin-bottom: 15px;
      flex-shrink: 0;
    }
    
    .sidebar.expanded .sidebar-header {
      justify-content: space-between;
    }

    .sidebar-header h3 {
      margin-top: 0;
      font-size: 18px;
      display: none;
    }

    .sidebar.expanded .sidebar-header h3 {
      display: block;
      margin-right: auto;
    }

    .sidebar-toggle-btn {
      background: none;
      border: none;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
      color: var(--text-color);
      padding: 0;
      line-height: 1;
    }

    .history-item {
      background: var(--box-bg);
      border: 1px solid var(--border-color);
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 10px;
      font-size: 14px;
      cursor: pointer;
      position: relative;
      transition: 0.2s;
    }
    .history-item:hover {
      background: rgba(0, 119, 182, 0.1);
    }

    .history-item::after {
      content: attr(data-answer);
      position: absolute;
      left: 105%;
      top: 50%;
      transform: translateY(-50%);
      background: var(--box-bg);
      border: 1px solid var(--border-color);
      padding: 8px 10px;
      border-radius: 10px;
      white-space: nowrap;
      display: none;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
      font-size: 13px;
      max-width: 200px;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .history-item:hover::after {
      display: block;
    }

    /* Main content */
    .container {
      flex: 1;
      text-align: center;
      width: 100%;
      max-width: 600px;
      position: relative;
      z-index: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
      margin: auto;
      height: 100%;
      padding: 20px 0;
      box-sizing: border-box;
    }

    /* Toggle button */
    .toggle {
      position: absolute;
      top: 16px;
      right: 20px;
      background: var(--box-bg);
      border: 1px solid var(--border-color);
      border-radius: 50%;
      padding: 8px;
      cursor: pointer;
      font-size: 16px;
      transition: 0.3s;
      z-index: 5;
    }
    .toggle:hover {
      background: var(--border-color);
    }
    
    .header {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-bottom: 30px;
    }

    .logo {
      width: 70px;
      margin-bottom: 14px;
    }

    h2 {
      margin: 0;
      font-weight: 500;
      text-shadow: 1px 1px 3px rgba(0,0,0,0.2);
    }

    /* Chat input */
    .chat-area {
      display: flex;
      flex-direction: column;
      gap: 12px;
      flex-shrink: 0;
    }

    .chat-box {
      background: var(--box-bg);
      border: 1px solid var(--border-color);
      border-radius: 16px;
      padding: 12px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .chat-box input {
      border: none;
      outline: none;
      flex: 1;
      background: transparent;
      color: var(--text-color);
      font-size: 15px;
    }

    .chat-box input::placeholder {
      color: var(--placeholder-color);
    }

    .chat-box button {
      background: none;
      border: none;
      cursor: pointer;
      font-size: 18px;
      color: var(--text-color);
      transition: 0.3s;
    }
    .chat-box button:hover {
      color: #0077b6;
    }

    /* Responses */
    .responses {
      margin-top: 16px;
      text-align: left;
      overflow-y: auto;
      flex-grow: 1;
      display: flex;
      flex-direction: column-reverse;
      padding-right: 15px;
    }

    .response {
      background: var(--box-bg);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      padding: 10px 14px;
      font-size: 14px;
      margin-bottom: 10px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.1);
      animation: fadeIn 0.3s ease-in;
    }

    @keyframes fadeIn {
      from {opacity: 0; transform: translateY(8px);}
      to {opacity: 1; transform: translateY(0);}
    }
  </style>
</head>
<body>
  <div class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <h3 class="sidebar-content">History</h3>
      <button class="sidebar-toggle-btn" onclick="toggleSidebar()">â˜°</button>
    </div>
    <div class="sidebar-body">
      <div id="history"></div>
    </div>
  </div>

  <button class="toggle" onclick="toggleMode()">ðŸŒ™</button>

  <div class="container">
    <div class="header">
      <img src="https://img.icons8.com/color/96/heart-with-pulse.png" class="logo" alt="logo"/>
      <h2>HealthMate-AI</h2>
    </div>
    
    <div class="responses" id="responses"></div>

    <div class="chat-area">
      <div class="chat-box">
        <input type="text" id="userInput" placeholder="How can I help you?">
        <button onclick="sendMessage()">âž¤</button>
      </div>
    </div>
  </div>

  <script>
    let historyData = [];

    document.getElementById('userInput').addEventListener('keyup', function(event) {
      if (event.key === 'Enter') {
        sendMessage();
      }
    });

    function toggleMode() {
      document.body.classList.toggle("dark");
      const btn = document.querySelector(".toggle");
      btn.textContent = document.body.classList.contains("dark") ? "â˜€ï¸" : "ðŸŒ™";
    }

    function toggleSidebar() {
      document.getElementById('sidebar').classList.toggle('expanded');
    }

    async function sendMessage() {
      const input = document.getElementById("userInput");
      const responsesDiv = document.getElementById("responses");
      const historyDiv = document.getElementById("history");
      const text = input.value.trim();
      if (!text) return;

      // Add user message to chat
      const userMessage = document.createElement("div");
      userMessage.className = "response";
      userMessage.style.textAlign = 'right';
      userMessage.style.background = '#0077b6';
      userMessage.style.color = 'white';
      userMessage.textContent = text;
      responsesDiv.prepend(userMessage);
      
      const lowerCaseText = text.toLowerCase();
      const predefinedQueries = [
        "what all things can you do", 
        "what can you do", 
        "what do you do", 
        "what all can you do",
        "what are your capabilities",
        "what are you capable of",
        "how can you help",
        "tell me what you can do",
        "what is your purpose",
        "what's your purpose"
      ];
      let answer;

      // Check if the user's query is one of the predefined ones
      if (predefinedQueries.includes(lowerCaseText)) {
        answer = "I can assist you with medical-related information and queries.";
      } else {
        // Create a temporary loading indicator for the AI response
        const loadingIndicator = document.createElement("div");
        loadingIndicator.className = "response";
        loadingIndicator.textContent = "HealthMate-AI is thinking...";
        responsesDiv.prepend(loadingIndicator);

        try {
          const formData = new FormData();
          formData.append("msg", text);

          const response = await fetch("/get", {
            method: "POST",
            body: formData,
          });

          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }

          answer = await response.text();
          loadingIndicator.remove();
        } catch (error) {
          console.error("Error fetching AI response:", error);
          loadingIndicator.textContent = "Failed to get a response. Please try again.";
          return; // Exit the function if there's an error
        }
      }

      const aiResponse = document.createElement("div");
      aiResponse.className = "response";
      aiResponse.textContent = answer;
      responsesDiv.prepend(aiResponse);

      // Save to history
      historyData.unshift({ question: text, answer });
      
      // Update sidebar
      historyDiv.innerHTML = "";
      historyData.forEach((item, index) => {
        const hItem = document.createElement("div");
        hItem.className = "history-item";
        hItem.textContent = item.question;
        hItem.setAttribute("data-answer", item.answer);

        // On click â†’ load into responses
        hItem.onclick = () => {
          responsesDiv.innerHTML = "";
          const userMsg = document.createElement("div");
          userMsg.className = "response";
          userMsg.style.textAlign = 'right';
          userMsg.style.background = '#0077b6';
          userMsg.style.color = 'white';
          userMsg.textContent = item.question;
          responsesDiv.appendChild(userMsg);
          
          const aiResp = document.createElement("div");
          aiResp.className = "response";
          aiResp.textContent = item.answer;
          responsesDiv.appendChild(aiResp);
        };

        historyDiv.appendChild(hItem);
      });

      // Clear input
      input.value = "";
    }
  </script>
</body>
</html>
